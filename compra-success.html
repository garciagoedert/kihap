<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://kihap.com.br/wp-content/uploads/2021/02/logo-wh.png" type="image/png">
    <title>Kihap - Compra Confirmada!</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="antialiased bg-gray-900 text-gray-200">

    <!-- Header -->
    <div id="header-container"></div>

    <main class="py-16">
        <section class="container mx-auto px-6 text-center">
            <h1 class="text-4xl md:text-5xl font-black uppercase font-title mb-8">
                Compra <span class="text-green-500">Confirmada!</span>
            </h1>

            <div class="max-w-2xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl">
                <p class="text-lg text-gray-300 mb-6">
                    Parabéns! Sua compra foi realizada com sucesso.
                </p>
                <p class="text-lg text-gray-300 mb-8">
                    Em breve, você receberá mais informações por e-mail.
                </p>
                <a href="/" class="bg-yellow-500 text-black font-bold py-3 px-8 rounded-lg hover:bg-yellow-600 transition text-lg inline-block">
                    Voltar para a Página Inicial
                </a>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div id="footer-container"></div>

    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            const statusMessage = document.querySelector('.text-lg.text-gray-300.mb-6');

            if (sessionId) {
                statusMessage.textContent = 'Verificando seu pagamento...';

                // Substitua pelo URL da sua função verifyPayment
                const verifyUrl = 'https://us-central1-intranet-kihap.cloudfunctions.net/verifyPayment';

                fetch(verifyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sessionId: sessionId }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        statusMessage.textContent = 'Parabéns! Sua compra foi realizada com sucesso.';
                    } else {
                        statusMessage.textContent = 'Seu pagamento foi concluído, mas houve um erro ao atualizar o status. Por favor, entre em contato com o suporte.';
                    }
                })
                .catch(error => {
                    console.error('Error verifying payment:', error);
                    statusMessage.textContent = 'Ocorreu um erro ao verificar seu pagamento. Por favor, entre em contato com o suporte.';
                });
            }
        });
    </script>
</body>
</html>
