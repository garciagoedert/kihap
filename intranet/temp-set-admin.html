<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Set Admin Flag</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center h-screen">

    <div class="bg-gray-800 p-8 rounded-lg shadow-lg text-center">
        <h1 class="text-2xl font-bold mb-4">Tornar Usuário Administrador</h1>
        <p class="text-gray-400 mb-6">Use esta página uma única vez para definir o primeiro administrador.</p>
        
        <input type="email" id="user-email" placeholder="Email do usuário a ser promovido" class="w-full px-4 py-2 mb-4 text-white bg-gray-700 border border-gray-600 rounded-md">
        
        <button id="set-admin-btn" class="w-full px-4 py-2 font-bold text-white bg-blue-600 rounded-md hover:bg-blue-700">Tornar Admin</button>

        <p id="status" class="mt-4 text-green-400"></p>
    </div>

    <script type="module">
        import { db } from './firebase-config.js';
        import { collection, query, where, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const setAdminBtn = document.getElementById('set-admin-btn');
        const emailInput = document.getElementById('user-email');
        const statusEl = document.getElementById('status');

        setAdminBtn.addEventListener('click', async () => {
            const email = emailInput.value.trim();
            if (!email) {
                statusEl.textContent = 'Por favor, insira um email.';
                statusEl.className = 'mt-4 text-red-400';
                return;
            }

            statusEl.textContent = 'Procurando usuário...';
            statusEl.className = 'mt-4 text-yellow-400';

            try {
                const usersRef = collection(db, "users");
                const q = query(usersRef, where("email", "==", email));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    statusEl.textContent = `Usuário com email ${email} não encontrado.`;
                    statusEl.className = 'mt-4 text-red-400';
                    return;
                }

                let userId;
                querySnapshot.forEach((doc) => {
                    userId = doc.id;
                });

                const userDocRef = doc(db, "users", userId);
                await updateDoc(userDocRef, {
                    isAdmin: true
                });

                statusEl.textContent = `Sucesso! ${email} agora é um administrador.`;
                statusEl.className = 'mt-4 text-green-400';
                emailInput.value = '';

            } catch (error) {
                console.error("Erro ao definir admin:", error);
                statusEl.textContent = `Erro: ${error.message}`;
                statusEl.className = 'mt-4 text-red-400';
            }
        });
    </script>

</body>
</html>
